# Kubernetes Documentation
## 1. Istio Service Mesh

Istio is a popular open-source service mesh platform that runs on Kubernetes to manage, secure, and observe microservices communication with advanced traffic control and security features.

### What is Istio Service Mesh?

- Istio provides a transparent infrastructure layer that intercepts and manages network communication between microservices without requiring changes in application code.
- It uses Envoy as a sidecar proxy injected alongside each service pod to handle traffic routing, load balancing, telemetry collection, and security policies like TLS encryption and authentication.
- Istio simplifies service discovery, failure recovery, traffic shifting (canary releases, blue-green deployments), and observability via metrics, logs, and traces.

### Key Components of Istio

- **Envoy Sidecar Proxy:** Sidecar proxies per microservice to handle ingress/egress traffic between services in the cluster and from a service to external services.
- **Istiod:** The Istio control plane. It provides service discovery, configuration and certificate management. It consists of the following sub-components:

**Pilot:** Responsible for configuring the proxies at runtime.  
**Citadel (now part of Istiod):** Responsible for certificate issuance and rotation.  
**Galley (deprecated, config validation):** Responsible for validating, ingesting, aggregating, transforming and distributing config within Istio.

- **operator:** The component provides user friendly options to operate the Istio service mesh.

### Benefits of Using Istio on Kubernetes

- Fine-grained traffic management (routing, retries, fault injection).
- Strong security with automatic mutual TLS between services.
- Observability with detailed metrics, distributed tracing, and logging.
- Platform-independent abstraction layer for microservice communications.
- Policy and access control enforcement per service or namespace.

### How to Get Started with Istio on Kubernetes

1. **Install Istio:** Download Istio CLI and install it on your Kubernetes cluster.
2. **Enable sidecar injection:** Label the namespace where your microservices run with `istio-injection=enabled`.
3. **Deploy your services:** Deploy your apps as usual; Istio automatically injects Envoy sidecars.
4. **Manage traffic:** Create Istio VirtualServices and DestinationRules for traffic routing.
5. **Monitor:** Use Istio add-ons like Kiali, Prometheus, Grafana, and Jaeger to observe service mesh health.

> NOTE: It Also need a gateway for exposing the service.
---
### 1. Install the istio 
```bash
curl -L https://istio.io/downloadIstio | sh -
cd istio-1.28.0
sudo mv istioctl /usr/local/bin
cd ..
istioctl install -f samples/bookinfo/demo-profile-no-gateways.yaml -y
```
### 2. Enable istio-injection
```bash
kubectl label namespace default istio-injection=enabled
```
### 3. Install the Kubernetes Gateway API CRDs
```bash
kubectl get crd gateways.gateway.networking.k8s.io &> /dev/null || \
{ kubectl kustomize "github.com/kubernetes-sigs/gateway-api/config/crd?ref=v1.4.0" | kubectl apply -f -; }
```
### 4. Deploy the sample application
```bash
kubectl apply -f samples/bookinfo/platform/kube/bookinfo.yaml
```
OR
```bash
kubectl apply -f https://raw.githubusercontent.com/istio/istio/release-1.28/samples/bookinfo/platform/kube/bookinfo.yaml
```
### 5. check the service and all the pods running or not
```bash
kubectl get pods
kubectl get services
kubectl get all
```
> NOTE: Here i got the issue that the pods are not creating so i troublshoot the problem and the istio -injection is blocking to create so i disable the istio-ijection and after that i delete it and again apply and enable the istio-injection

```bash
kubectl delete -f https://raw.githubusercontent.com/istio/istio/release-1.28/samples/bookinfo/platform/kube/bookinfo.yaml
kubectl label namespace default istio-injection=disenabled
kubectl apply -f https://raw.githubusercontent.com/istio/istio/release-1.28/samples/bookinfo/platform/kube/bookinfo.yaml
kubectl label namespace default istio-injection=enabled
```
### 6. Open the application to outside traffic (Gateway)
```bash
kubectl apply -f samples/bookinfo/gateway-api/bookinfo-gateway.yaml

kubectl annotate gateway bookinfo-gateway networking.istio.io/service-type=ClusterIP --namespace=default
kubectl get gateway

```
### 7. Access The Sample App
```bash
kubectl port-forward svc/bookinfo-gateway-istio 8080:80
```
* Open your browser and navigate to `http://localhost:8080/productpage` to view the Bookinfo application.

### 8. View dashboard
```bash
kubectl apply -f samples/addons/kiali.yaml
kubectl rollout status deployment/kiali -n istio-system
# access the dashboard using below command
istioctl dashboard kiali
# in dashboard open graph and run below command in terminal
for i in $(seq 1 100); do curl -s -o /dev/null "http://localhost:8080/productpage"; done
```
