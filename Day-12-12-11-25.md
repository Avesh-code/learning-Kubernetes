# Kubernetes Documentation
## Installation of Prometheus on system  (Bare Metal)
* To Downoad and unzip the app
```bash
wget https://github.com/prometheus/prometheus/releases/download/v3.7.3/prometheus-3.7.3.linux-amd64.tar.gz
tar -xzf prometheus-3.7.3.linux-amd64.tar.gz 
cd prometheus-3.7.3.linux-amd64/
```
* To run the prometheus App
```bash
./prometheus --config.file=prometheus.yml
```
* Now we can access through `http://localhost:9090`
* But to Run this as a Service we should make a `/etc/systemd/system/prometheus.service` file
```bash
sudo vim /etc/systemd/system/prometheus.service
```
```service
[Unit]
Description=Prometheus
Wants=network-online.target
After=network-online.target

[Service]
User=aveshpadaya
ExecStart=/home/aveshpadaya/monitoring/prometheus-3.7.3.linux-amd64/prometheus --config.file=/home/aveshpadaya/monitoring/prometheus-3.7.3.linux-amd64/prometheus.yml
Restart=always

[Install]
WantedBy=multi-user.target
```
* Reload start and enable the service 
```bash
sudo systemctl daemon-reload
sudo systemctl start prometheus
sudo systemctl enable prometheus
sudo systemctl status prometheus
```

* now you could get the Access using `http://localhost:9090` but in my case i got issue to store the logs in data folder so i made a data folder.

> Note : The issue was there that prometheus could not find the data folder so make a data folder for that issue 
```bash
sudo mkdir -p /data
sudo chown aveshpadaya:aveshpadaya /data
```
```
sudo systemctl daemon-reload
sudo systemctl restart prometheus
sudo systemctl status prometheus
```
## Installation of Node-Exporter on system  (Bare Metal)
* Download The node exporter
```bash
wget https://github.com/prometheus/node_exporter/releases/download/v1.10.2/node_exporter-1.10.2.linux-amd64.tar.gz
tar -xzf node_exporter-1.10.2.linux-amd64.tar.gz
cd node_exporter-1.10.2.linux-amd64/
./node_exporter
```
* It will run as a local but if we want to run as a Service. then do below Commands and configuration
```bash
sudo mv node_exporter /usr/local/bin/
sudo vim /etc/systemd/system/node_exporter.service
```
```service
[Unit]
Description=Prometheus Node Exporter
Wants=network-online.target
After=network-online.target

[Service]
User=aveshpadaya
ExecStart=/usr/local/bin/node_exporter
Restart=always

[Install]
WantedBy=default.target
```
```bash
sudo systemctl daemon-reload
sudo systemctl start node_exporter
sudo systemctl enable node_exporter
sudo systemctl status node_exporter
```
* the service is up and running at `http://localhost:9100`but we have also to notify the prometheus about the node exporter so we should update the `prometheus.yml` file 
```yml
# my global config
global:
  scrape_interval: 15s # Set the scrape interval to every 15 seconds. Default is every 1 minute.
  evaluation_interval: 15s # Evaluate rules every 15 seconds. The default is every 1 minute.
  # scrape_timeout is set to the global default (10s).

# Alertmanager configuration
alerting:
  alertmanagers:
    - static_configs:
        - targets:
          # - alertmanager:9093

# Load rules once and periodically evaluate them according to the global 'evaluation_interval'.
rule_files:
  # - "first_rules.yml"
  # - "second_rules.yml"

# A scrape configuration containing exactly one endpoint to scrape:
# Here it's Prometheus itself.
scrape_configs:
  # The job name is added as a label `job=<job_name>` to any timeseries scraped from this config.
  - job_name: "prometheus"

    # metrics_path defaults to '/metrics'
    # scheme defaults to 'http'.

    static_configs:
      - targets: ["localhost:9090"]
       # The label name is added as a label `label_name=<label_value>` to any timeseries scraped from this config.
        labels:
          app: "prometheus"
# The below configuration is added for accessing the node-exporter in Prometheus
  - job_name: 'node_exporter'
    static_configs:
      - targets: ['localhost:9100']
```
```bash
sudo systemctl daemon-reload
sudo systemctl restart prometheus
sudo systemctl status prometheus
```
* now we can check the connectivity at `http://localhost:9090/targets`
## Installation of Grafana on system  (Bare Metal)
* Use the grafana official download page for version get the commands from that website
```bash
sudo apt-get install -y adduser libfontconfig1 musl
wget https://dl.grafana.com/grafana-enterprise/release/12.2.1/grafana-enterprise_12.2.1_18655849634_linux_amd64.deb
sudo dpkg -i grafana-enterprise_12.2.1_18655849634_linux_amd64.deb
```
* we can check and start the service 
```bash
sudo systemctl daemon-reload
sudo systemctl start grafana-server
sudo systemctl enable grafana-server
sudo systemctl status grafana-server
```
* now we can access this on `http://localhost:3000`
* Username
```
admin
```
* password
```
admin
```
* after that we can change it and add the datasource as Prometheus in Grafana UI for test 
* Go to Dashboard and import a Dashboard 1860 and select prometheus and there u go ...
* The System Metrics is available on this.
